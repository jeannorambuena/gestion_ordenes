{% extends 'base.html' %}

{% block content %}
<style>
  th {
    border: 2px solid #0dcaf0 !important;
  }
  td {
    border: 1px solid #dee2e6 !important;
  }
</style>
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-12">
      <div class="card shadow rounded-4 border-0">
        <div class="card-header bg-info text-white rounded-top-4 text-center py-3">
          <h3 class="mb-0 fw-semibold">
            <i class="fas fa-clipboard-list me-2"></i>
            Lista de Órdenes de Trabajo
          </h3>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-bordered table-hover align-middle mb-0 text-center">
              <thead class="table-info small text-uppercase">
                <tr>
                  <th scope="col"># Orden</th>
                  <th scope="col">Funcionario</th>
                  <th scope="col">RUT</th>
                  <th scope="col">Colegio</th>
                  <th scope="col">Fecha Inicio</th>
                  <th scope="col">Fecha Término</th>
                  <th scope="col">Tipo de Contrato</th>
                  <th scope="col">Financiamiento</th>
                  <th scope="col">Horas</th>
                  <th scope="col">Acciones</th>
                </tr>
              </thead>
              <tbody>
                {% for orden in ordenes %}
                <tr>
                  <td>{{ orden.numero_orden or 'N/A' }}</td>
                  <td>
                  {% if orden.funcionario_directo %}
                    {{ orden.funcionario_directo.nombre }} {{ orden.funcionario_directo.apellido }}
                  {% else %}
                    <em>No asignado</em>
                  {% endif %}
                </td>
                  <td>{{ orden.rut_cuerpo }}-{{ orden.rut_dv }}</td>
                  <td>{{ orden.colegio.nombre_colegio if orden.colegio else 'No asignado' }}</td>
                  <td>{{ orden.fecha_inicio.strftime('%d-%m-%Y') }}</td>
                  <td>
                    {{ 'Indefinido' if orden.es_indefinido else (orden.fecha_termino.strftime('%d-%m-%Y') if orden.fecha_termino else 'Indefinido') }}
                  </td>
                  <td>{{ orden.tipo_contrato.nombre if orden.tipo_contrato else 'No asignado' }}</td>
                  <td>{{ orden.financiamiento.nombre_financiamiento if orden.financiamiento else 'No asignado' }}</td>
                  <td>{{ orden.horas_disponibles if orden.horas_disponibles is not none else 'Sin horas' }}</td>
                  <td>
                    <div class="btn-group" role="group">
                      <a href="{{ url_for('ordenes_bp.editar_orden', id=orden.id) }}" class="btn btn-outline-warning btn-sm" title="Editar">
                        <i class="fas fa-edit"></i>
                      </a>
                      <a href="{{ url_for('ordenes_bp.imprimir_orden', id=orden.id) }}" class="btn btn-outline-secondary btn-sm" target="_blank" title="Vista previa">
                        <i class="fas fa-eye"></i>
                      </a>
                      <a href="{{ url_for('ordenes_bp.generar_pdf_orden', id=orden.id) }}" class="btn btn-outline-info btn-sm" target="_blank" title="PDF">
                        <i class="fas fa-file-pdf"></i>
                      </a>
                    </div>
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="10" class="text-center text-muted py-4">No hay órdenes de trabajo disponibles.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        <div class="card-footer bg-light text-center rounded-bottom-4">
          <a href="{{ url_for('ordenes_bp.nueva_orden') }}" class="btn btn-info btn-lg rounded-pill shadow px-4 text-white">
            <i class="fas fa-plus-circle me-2"></i>Crear Nueva Orden
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
