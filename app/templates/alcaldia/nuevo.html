{% extends 'base.html' %}

{% block title %}Nueva Alcaldía{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="text-center mb-4">Asignar Nueva Alcaldía</h2>
  <form method="POST" action="{{ url_for('alcaldia.nueva_alcaldia') }}" class="mx-auto p-4 shadow rounded bg-light" style="max-width: 600px;">
    {{ form.hidden_tag() }}

    <!-- Selector de Funcionario -->
    <div class="mb-3">
      <label for="funcionario" class="form-label">Funcionario</label>
      {{ form.funcionario(class="form-select", id="funcionario") }}
      {% for error in form.funcionario.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- Email (readonly) -->
    <div class="mb-3">
      <label for="email" class="form-label">Email</label>
      <input type="text" id="email" class="form-control" readonly>
    </div>

    <!-- Teléfono (readonly) -->
    <div class="mb-3">
      <label for="telefono" class="form-label">Teléfono</label>
      <input type="text" id="telefono" class="form-control" readonly>
    </div>

    <!-- Cargo (readonly) -->
    <div class="mb-3">
      <label for="cargo" class="form-label">Cargo</label>
      <input type="text" id="cargo" class="form-control" readonly>
    </div>

    <!-- Fecha de Inicio -->
    <div class="mb-3">
      <label for="fecha_inicio" class="form-label">Fecha de Inicio</label>
      {{ form.fecha_inicio(class="form-control", id="fecha_inicio") }}
      {% for error in form.fecha_inicio.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- Fecha de Término -->
    <div class="mb-3">
      <label for="fecha_termino" class="form-label">Fecha de Término</label>
      {{ form.fecha_termino(class="form-control", id="fecha_termino") }}
      {% for error in form.fecha_termino.errors %}
        <div class="text-danger">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- Botones -->
    <div class="d-flex justify-content-between">
      <button type="submit" class="btn btn-primary">Guardar</button>
      <a href="{{ url_for('alcaldia.listar_alcaldias') }}" class="btn btn-secondary">Cancelar</a>
    </div>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const funcionarioSelect = document.getElementById("funcionario");
    funcionarioSelect.addEventListener("change", async function () {
      const value = this.value;
      if (!value) return;

      try {
        const response = await fetch(`/funcionarios/detalle/${value}`);
        const data = await response.json();
        document.getElementById("email").value = data.email || '';
        document.getElementById("telefono").value = data.telefono || '';
        document.getElementById("cargo").value = data.cargo || '';
      } catch (err) {
        console.error("❌ Error al obtener datos del funcionario:", err);
      }
    });
  });
</script>
{% endblock %}
